<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - TherapyConnect</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="chat-widget.css">
    <style>
        .dashboard-container {
            min-height: 100vh;
            padding-top: 100px;
        }

        .dashboard-header {
            text-align: center;
            padding: 3rem 2rem;
            background: linear-gradient(135deg, rgba(102, 194, 165, 0.1), rgba(141, 211, 199, 0.05));
            border-radius: 20px;
            margin-bottom: 3rem;
        }

        .welcome-message {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: white;
        }

        .user-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(102, 194, 165, 0.2);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            color: var(--therapeutic-green);
            font-weight: 600;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .dashboard-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            border: 1px solid rgba(102, 194, 165, 0.2);
            padding: 2rem;
            transition: all 0.3s;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 194, 165, 0.3);
            border-color: var(--therapeutic-green);
        }

        .card-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: white;
        }

        .card-description {
            color: var(--gray);
            margin-bottom: 1.5rem;
        }

        .card-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--therapeutic-green);
            margin-bottom: 1rem;
        }

        .quick-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .quick-action-btn {
            background: linear-gradient(135deg, var(--therapeutic-green), var(--peaceful-teal));
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .quick-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 194, 165, 0.4);
        }

        .upcoming-sessions {
            background: rgba(102, 194, 165, 0.05);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .session-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--therapeutic-green);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .session-info h4 {
            color: white;
            margin-bottom: 0.5rem;
        }

        .session-info p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .session-time {
            text-align: right;
        }

        .session-date {
            color: var(--therapeutic-green);
            font-weight: 600;
        }

        .progress-section {
            background: rgba(255, 255, 255, 0.03);
            padding: 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--therapeutic-green), var(--peaceful-teal));
            height: 100%;
            transition: width 1s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: rgba(102, 194, 165, 0.1);
            border-radius: 10px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--therapeutic-green);
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .welcome-message {
                font-size: 2rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .session-item {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }

            .session-time {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="gradient-bg"></div>
    <div class="particles"></div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <span class="logo-icon">üß†</span>
                <span class="logo-text">TherapyConnect</span>
            </div>
            <div class="nav-links">
                <a href="dashboard.html">Dashboard</a>
                <a href="sessions.html">Sessions</a>
                <a href="therapists.html">Therapists</a>
                <a href="resources.html">Resources</a>
                <a href="profile.html">Profile</a>
                <button class="btn btn-secondary" onclick="logout()">Logout</button>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <div class="container">
            <!-- Header -->
            <div class="dashboard-header">
                <h1 class="welcome-message">Welcome back, <span id="userName">User</span>! üíö</h1>
                <div class="user-status">
                    <span class="status-dot active"></span>
                    <span id="planName">Free Trial Active</span>
                    <span>‚Ä¢</span>
                    <span id="daysRemaining">28 days remaining</span>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="card-icon">üìÖ</div>
                    <h3 class="card-title">Sessions This Month</h3>
                    <div class="card-value">2 / 4</div>
                    <p class="card-description">You have 2 sessions remaining</p>
                    <a href="sessions.html" class="quick-action-btn">Book Session</a>
                </div>

                <div class="dashboard-card">
                    <div class="card-icon">üìà</div>
                    <h3 class="card-title">Wellness Score</h3>
                    <div class="card-value">78%</div>
                    <p class="card-description">Great progress this week!</p>
                    <a href="progress.html" class="quick-action-btn">View Details</a>
                </div>

                <div class="dashboard-card">
                    <div class="card-icon">üí¨</div>
                    <h3 class="card-title">Messages</h3>
                    <div class="card-value">3</div>
                    <p class="card-description">New messages from your therapist</p>
                    <a href="messages.html" class="quick-action-btn">Read Messages</a>
                </div>

                <div class="dashboard-card">
                    <div class="card-icon">üéØ</div>
                    <h3 class="card-title">Goals Completed</h3>
                    <div class="card-value">5 / 8</div>
                    <p class="card-description">Keep up the amazing work!</p>
                    <a href="goals.html" class="quick-action-btn">View Goals</a>
                </div>
            </div>

            <!-- Upcoming Sessions -->
            <div class="upcoming-sessions">
                <h2 style="color: white; margin-bottom: 1.5rem;">üìÖ Upcoming Sessions</h2>
                
                <div class="session-item">
                    <div class="session-info">
                        <h4>Video Session with Dr. Sarah Chen</h4>
                        <p>General Therapy ‚Ä¢ 60 minutes</p>
                    </div>
                    <div class="session-time">
                        <div class="session-date">Tomorrow, 2:00 PM</div>
                        <a href="join-session.html" class="quick-action-btn" style="margin-top: 0.5rem;">Join Session</a>
                    </div>
                </div>

                <div class="session-item">
                    <div class="session-info">
                        <h4>Chat Session with Dr. Michael Torres</h4>
                        <p>Anxiety Support ‚Ä¢ 45 minutes</p>
                    </div>
                    <div class="session-time">
                        <div class="session-date">Friday, 10:00 AM</div>
                        <a href="schedule.html" class="quick-action-btn" style="margin-top: 0.5rem;">Reschedule</a>
                    </div>
                </div>

                <a href="sessions.html" class="quick-action-btn" style="margin-top: 1rem;">View All Sessions</a>
            </div>

            <!-- Progress Section -->
            <div class="progress-section">
                <h2 style="color: white; margin-bottom: 1.5rem;">üìä Your Wellness Journey</h2>
                
                <h4 style="color: var(--therapeutic-green); margin-bottom: 0.5rem;">Overall Progress</h4>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 78%;"></div>
                </div>
                <p style="color: var(--gray); margin-bottom: 2rem;">You're making excellent progress! Keep it up!</p>

                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">12</div>
                        <div class="stat-label">Total Sessions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">5</div>
                        <div class="stat-label">Goals Achieved</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">45</div>
                        <div class="stat-label">Days Active</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">8.5</div>
                        <div class="stat-label">Avg Mood Score</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div style="text-align: center; margin-top: 3rem;">
                <h2 style="color: white; margin-bottom: 2rem;">Quick Actions</h2>
                <div class="quick-actions" style="justify-content: center;">
                    <a href="resources.html" class="quick-action-btn" style="background: linear-gradient(135deg, #667eea, #764ba2); font-size: 1.1rem;">üéÆ Play Games & Resources</a>
                    <a href="book-session.html" class="quick-action-btn">üìÖ Book New Session</a>
                    <a href="find-therapist.html" class="quick-action-btn">üë• Find Therapist</a>
                    <a href="journal.html" class="quick-action-btn">üìù Write Journal</a>
                    <a href="exercises.html" class="quick-action-btn">üßò Practice Exercise</a>
                    <a href="community.html" class="quick-action-btn">üåü Join Community</a>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Check if user is authenticated
        const checkAuth = () => {
            const userData = JSON.parse(localStorage.getItem('therapyConnectUser') || '{}');
            if (!userData.email || !userData.subscriptionActive) {
                // Redirect to signup if not authenticated
                window.location.href = 'signup.html';
                return false;
            }
            return true;
        };

        // Check auth immediately
        if (!checkAuth()) {
            throw new Error('Unauthorized');
        }

        // Load real user data
        window.addEventListener('DOMContentLoaded', () => {
            const userData = JSON.parse(localStorage.getItem('therapyConnectUser') || '{}');
            const progressKey = `progress_${userData.email}`;
            const progress = JSON.parse(localStorage.getItem(progressKey) || '{}');
            const stats = progress.stats || {};
            
            const sessionsKey = `therapy_sessions_${userData.email}`;
            const sessions = JSON.parse(localStorage.getItem(sessionsKey) || '[]');
            
            const activitiesCount = progress.activities ? progress.activities.length : 0;
            
            // Update user name
            if (userData.fullName) {
                document.getElementById('userName').textContent = userData.fullName;
            }
            
            // Update plan
            if (userData.plan) {
                const planNames = {
                    trial: 'Free Trial Active',
                    basic: 'Basic Plan',
                    premium: 'Premium Plan',
                    enterprise: 'Enterprise Plan'
                };
                document.getElementById('planName').textContent = planNames[userData.plan] || 'Free Trial Active';
            }
            
            // Calculate wellness score
            const wellnessScore = Math.min(100, Math.round(((stats.sessionsCompleted || 0) * 10 + (stats.exercisesCompleted || 0) * 5 + (stats.streak || 0) * 3) / 2));
            
            // Update dashboard cards
            document.querySelector('.dashboard-card:nth-child(1) .card-value').textContent = `${sessions.length} / ‚àû`;
            document.querySelector('.dashboard-card:nth-child(1) .card-description').textContent = sessions.length > 0 ? 'Unlimited AI sessions available' : 'Start your first session today!';
            
            document.querySelector('.dashboard-card:nth-child(2) .card-value').textContent = wellnessScore + '%';
            document.querySelector('.dashboard-card:nth-child(2) .card-description').textContent = wellnessScore > 70 ? 'Great progress this week!' : wellnessScore > 40 ? 'Keep going, you\'re improving!' : 'Let\'s start your journey!';
            
            document.querySelector('.dashboard-card:nth-child(3) .card-value').textContent = sessions.length;
            document.querySelector('.dashboard-card:nth-child(3) .card-description').textContent = sessions.length > 0 ? 'Chat sessions completed' : 'No sessions yet';
            
            document.querySelector('.dashboard-card:nth-child(4) .card-value').textContent = `${stats.exercisesCompleted || 0} / ${(stats.exercisesCompleted || 0) + 3}`;
            document.querySelector('.dashboard-card:nth-child(4) .card-description').textContent = stats.exercisesCompleted > 5 ? 'Amazing consistency!' : 'Keep up the great work!';
            
            // Update upcoming sessions
            const upcomingSessions = document.querySelector('.upcoming-sessions');
            const activeSessions = sessions.filter(s => !s.endTime);
            
            if (activeSessions.length > 0 || sessions.length > 0) {
                const recentSessions = sessions.slice(-3).reverse();
                upcomingSessions.innerHTML = `
                    <h2 style="color: white; margin-bottom: 1.5rem;">üìÖ Recent Sessions</h2>
                    ${recentSessions.map(session => {
                        const date = new Date(session.startTime);
                        const status = session.endTime ? 'Completed' : 'Active';
                        return `
                            <div class="session-item">
                                <div class="session-info">
                                    <h4>${status} AI Therapy Session</h4>
                                    <p>${session.topics.join(', ') || 'Wellness chat'} ‚Ä¢ ${session.messageCount} messages</p>
                                </div>
                                <div class="session-time">
                                    <div class="session-date">${date.toLocaleDateString()}, ${date.toLocaleTimeString()}</div>
                                    <a href="sessions.html" class="quick-action-btn" style="margin-top: 0.5rem;">View Details</a>
                                </div>
                            </div>
                        `;
                    }).join('')}
                    <a href="sessions.html" class="quick-action-btn" style="margin-top: 1rem;">View All Sessions</a>
                `;
            } else {
                upcomingSessions.innerHTML = `
                    <h2 style="color: white; margin-bottom: 1.5rem;">üìÖ Get Started</h2>
                    <div style="text-align: center; padding: 2rem; background: rgba(255,255,255,0.05); border-radius: 15px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üí¨</div>
                        <h3 style="color: white; margin-bottom: 0.5rem;">Ready to start your wellness journey?</h3>
                        <p style="color: var(--gray); margin-bottom: 1.5rem;">Chat with NUPI anytime, 24/7. Your AI therapist is always here to listen.</p>
                        <button onclick="document.getElementById('chatBubbleBtn')?.click() || alert('Chat widget loading...')" class="quick-action-btn">üí¨ Start Your First Session</button>
                    </div>
                `;
            }
            
            // Update progress section
            document.querySelector('.progress-fill').style.width = wellnessScore + '%';
            document.querySelector('.progress-section p').textContent = wellnessScore > 70 ? 'You\'re making excellent progress! Keep it up!' : wellnessScore > 40 ? 'Good progress! Stay consistent for better results.' : 'Let\'s build momentum together!';
            
            // Update stats
            const statItems = document.querySelectorAll('.stat-item');
            statItems[0].querySelector('.stat-number').textContent = sessions.length || 0;
            statItems[0].querySelector('.stat-label').textContent = 'Total Sessions';
            
            statItems[1].querySelector('.stat-number').textContent = stats.exercisesCompleted || 0;
            statItems[1].querySelector('.stat-label').textContent = 'Exercises Done';
            
            statItems[2].querySelector('.stat-number').textContent = stats.streak || 0;
            statItems[2].querySelector('.stat-label').textContent = 'Day Streak';
            
            statItems[3].querySelector('.stat-number').textContent = activitiesCount || 0;
            statItems[3].querySelector('.stat-label').textContent = 'Total Activities';
            
            // Calculate days remaining for trial
            if (userData.createdAt && userData.plan === 'trial') {
                const created = new Date(userData.createdAt);
                const now = new Date();
                const daysPassed = Math.floor((now - created) / (1000 * 60 * 60 * 24));
                const daysRemaining = Math.max(0, 30 - daysPassed);
                document.getElementById('daysRemaining').textContent = `${daysRemaining} days remaining`;
            }
        });

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('therapyConnectUser');
                localStorage.removeItem('therapyConnectRemember');
                window.location.href = 'index.html';
            }
        }
    </script>
    <script src="chat-widget.js"></script>
</body>
</html>
